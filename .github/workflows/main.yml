name: macOS Chrome Remote Desktop
on: workflow_dispatch

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Install Chrome Remote Desktop
        run: |
          brew install --cask chrome-remote-desktop-host
          
      - name: Setup and Start Session
        run: |
          # Define the correct macOS path for the CRD binary
          CRD_PATH="/Library/PrivilegedHelperTools/com.google.ChromeRemoteDesktop.bundle/Contents/MacOS/com.google.ChromeRemoteDesktop.NativeMessagingHost"
          
          # If that path doesn't exist, we search for it
          if [ ! -f "$CRD_PATH" ]; then
            CRD_PATH=$(find /Library -name "remoting_start_host" -type f 2>/dev/null | head -n 1)
          fi
          
          echo "Using binary at: $CRD_PATH"
          
          # RUN YOUR COMMAND BELOW (Remember to use a FRESH code from Google)
          DISPLAY= /opt/google/chrome-remote-desktop/start-host --code="4/0ASc3gC1SzvLKSINCM3q1H_ayAF5bu-fuXDZ-kxrHpzTwwrIchJ1DAwQ4aXZYU5Zl3bdpjQ" --redirect-url="https://remotedesktop.google.com/_/oauthredirect" --name=$(hostname)
          
      - name: Keep Runner Alive
        run: |
          echo "Keep-alive active. Connect at https://remotedesktop.google.com/access"
          sleep 21600
