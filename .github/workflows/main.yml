name: macOS Chrome Remote Desktop
on: workflow_dispatch

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Download and Install Chrome Remote Desktop
        run: |
          curl -L -o install.pkg https://dl.google.com/chrome-remote-desktop/chromeremotedesktophost.pkg
          sudo installer -pkg install.pkg -target /
          
      - name: Setup Chrome Remote Desktop Session
        run: |
          # Use the command you generated from Google's headless setup page
          # Replace the placeholder below with your actual command if the token has expired
          DISPLAY= /opt/google/chrome-remote-desktop/start-host --code="4/0ASc3gC0n4LT4ECjhn05MItT-JtlwutwQrpsfBeeAaVMDRsYET7Da1Lx07JHg7wl2TJmrIg" --redirect-url="https://remotedesktop.google.com/_/oauthredirect" --name=$(hostname)
          
      - name: Keep Runner Alive
        run: |
          echo "Keep-alive active. Connect via https://remotedesktop.google.com/access"
          # This keeps the VM running for 6 hours (the GitHub max)
          sleep 21600 
