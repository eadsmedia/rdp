name: macOS noVNC Debug

on:
  workflow_dispatch:

jobs:
  novnc:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install VNC + noVNC
        run: |
          brew update
          brew install tiger-vnc novnc websockify

      - name: Configure VNC
        run: |
          mkdir -p ~/.vnc
          echo "debug123" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd

          cat > ~/.vnc/xstartup << 'EOF'
          #!/bin/sh
          unset SESSION_MANAGER
          unset DBUS_SESSION_BUS_ADDRESS
          open -a Finder
          EOF

          chmod +x ~/.vnc/xstartup

      - name: Start VNC server
        run: |
          vncserver -localhost no :1

      - name: Start noVNC
        run: |
          websockify --web=/opt/homebrew/share/novnc/ 6080 localhost:5901
