name: macOS noVNC Debug

on:
  workflow_dispatch:

jobs:
  novnc:
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install noVNC + VNC
        run: |
          brew update
          brew install tiger-vnc novnc websockify

      - name: Configure VNC
        run: |
          mkdir -p ~/.vnc
          echo "debug123" | vncpasswd -f > ~/.vnc/passwd
          chmod 600 ~/.vnc/passwd
          echo '#!/bin/sh
          unset SESSION_MANAGER
          unset DBUS_SESSION_BUS_ADDRESS
          exec /System/Library/CoreServices/Finder.app/Contents/MacOS/Finder &' > ~/.vnc/xstartup
          chmod +x ~/.vnc/xstartup

      - name: Start VNC server
        run: |
          vncserver -localhost no :1

      - name: Start noVNC (Web)
        run: |
          websockify --web=/opt/homebrew/share/novnc/ 6080 localhost:5901
